---
date: 2013-06-01 10:20:38+00:00
layout: post
title: "解决DedeCMS后台登录错误页"
categories: lessons
tags : [DedeCMS, php, win7]
---

先说下本地搭建的环境

系统：**windows7**
DedeCMS版本：**V5.7正式版**
php版本：**v5.4.14**
<!-- more -->
安装DedeCMS，一路next，没粗线什么问题，却在登录界面死掉了。密码错误或者验证码出错，都会粗线相关的提示，可是都正确的话，浏览器就提示找不到dede/login.php，刷新下又跳转回原来的登录界面。

原因是：php版本过高，**session_register**函数已自 PHP 5.3.0 起废弃并将自 PHP 5.4.0 起移除。DedeCMS是通过**session_register**这个函数来实现登录功能的，因此只要把这个bug给修好，就可以了。

找到**include/userlogin.class.php**，进行编辑，将

<pre class="prettyprint linenums">
@session_register($this-&gt;keepUserIDTag);
</pre>
注释掉或者删掉，替换为
<pre class="prettyprint linenums">
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
</pre>

大概在288行左右，总共要改6处，改好后大概是酱紫：

<pre class="prettyprint linenums">
//@session_register($this-&gt;keepUserIDTag);
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
$_SESSION[$this-&gt;keepUserIDTag] = $this-&gt;userID;

//@session_register($this-&gt;keepUserTypeTag);
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
$_SESSION[$this-&gt;keepUserTypeTag] = $this-&gt;userType;

//@session_register($this-&gt;keepUserChannelTag);
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
$_SESSION[$this-&gt;keepUserChannelTag] = $this-&gt;userChannel;

//@session_register($this-&gt;keepUserNameTag);
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
$_SESSION[$this-&gt;keepUserNameTag] = $this-&gt;userName;

//@session_register($this-&gt;keepUserPurviewTag);
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
$_SESSION[$this-&gt;keepUserPurviewTag] = $this-&gt;userPurview;

//@session_register($this-&gt;keepAdminStyleTag);
if (!isset($_SESSION[$this-&gt;keepUserIDTag]))
$_SESSION[$this-&gt;keepAdminStyleTag] = $adminstyle;
</pre>

保存好，刷新下登录页面，重新登录，应该就ok了<(￣︶￣)>