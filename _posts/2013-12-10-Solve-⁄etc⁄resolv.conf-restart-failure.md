---
layout: post
category : lessons
title:  "解决/etc/resolv.conf重启失效"
date: 2013-12-10 16:34:22 -0700
tags : [ fedora , dns ]
---
之前被`/etc/resolv.conf`这个文件坑过，导致firefox无法正常联网，wordpress主题和插件无法正常搜索。今天`yum update`，报错提示无法连接到xx主机，可是ping得通，也是它搞的鬼，害咱几乎把所有的源都删了，还好有备份。
<!-- more -->

以前也遇到`yum update`出错的状况，说下今天遇到的倒霉事，以至于我第一反应不会想到是它。

上完早课，回到宿舍，打开电脑，居然卡死在ked登录界面，死活进不去fedora。按照往常的经验，重启下就没问题，有时比较贱，需要重启几次才可以。今天就悲剧了，alt+f2查看了下错误，有一个是说无法自动挂载windows下的一个分区，于是进配置文件`/etc/fstab`，删掉了那行自动挂载的东西。

又重启了几次，进得去系统了，就是无法联网，`iwconfig`看了下，居然没找到网卡。于是只好用手机下载驱动，然后拷贝到电脑安装，蛋疼死了，幸好文件不是很大，要不那破手机还真塞不下。安装好驱动，就重启了，一切正常。

查看`/etc/resolv.conf`，发现：

<pre class="prettyprint linenums">
# Generated by NetworkManager
nameserver 218.85.157.99
nameserver 218.85.152.99
</pre>

这个咱以前说过，改成这样就没问题：

<pre class="prettyprint linenums">
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 8.8.4.4
</pre>

可是重启就打回原型了，这时候我们可以在`/etc/sysconfig/network-scripts/`目录下找相关的配置文件，让它不自动修改nameserver。

咱是用无线上网的，ssid是`fewspider`，找到该目录下相似的配置文件，例如在咱本机上的是`ifcfg-fewspider`，修改其`PEERDNS`的属性即可。

修改前：

<pre class="prettyprint linenums">
PEERDNS=yes
</pre>

修改后：

<pre class="prettyprint linenums">
PEERDNS=no
</pre>

重启，原来的`/etc/resolv.conf`里面的`nameserver`可能都没了，把它改回原来的配置即可。

<pre class="prettyprint linenums">
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 8.8.4.4
</pre>

再重启试下，这时候就没问题了。