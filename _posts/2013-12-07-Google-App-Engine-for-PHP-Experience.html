---
layout: post
category : lessons
title:  "Google App Engine for PHP试用"
date: 2013-12-07 07:40:22 -0700
tags : [ GAE , php ]
---
申请Google App Engine for PHP通过已经好长一段时间了，一开始的时候很兴奋，可是脑子笨(。>︿<)_θ，不明白肿么使用。虽然官方有指南，但是还是出现了一些意想不到的惊喜Σ(っ°Д °;)っ，卡在php环境那边。然后就懒得折腾了，今天闲得蛋疼，又挖坟挖出来了。
<!-- more -->

按照官方指南，先下载SDK。其实这玩意，咱很久以前就有听说过Google App Engine，就是折腾goagent的时候。部署goagent也用不着下载SDK。总之算是新的开始，我不会告诉你我被Google App Engine宣传视频的那个小哥给吸引了，不对，被他的演示给吸引了。没想象中那么复杂，而且以前也学过php，最近也在学python，GAE是个很好的练手的地方。

下载SDK并解压：
<pre class="prettyprint linenums">
wget http://googleappengine.googlecode.com/files/google_appengine_1.8.8.zip
unzip google_appengine_1.8.8.zip
</pre>

接下来的一切操作都是在解压后的`google_appengine`目录下执行。

创建新文件夹，叫`helloworld`。

<pre class="prettyprint linenums">
mkdir helloworld
</pre>

再到该目录下创建`helloworld.php`文件：

<pre class="prettyprint linenums">
&lt;?php
  echo 'Hello, World!';
</pre>

再创建配置文件`app.yaml`：

<pre class="prettyprint linenums">
application: helloworld
version: 1
runtime: php
api_version: 1

handlers:
- url: /.*
  script: helloworld.php
</pre>

接下来就是测试了：

<pre class="prettyprint linenums">
./dev_appserver.py ./helloworld
</pre>

理论上，人品好的话，就可以直接访问`http://localhost:8080/`，看到浏览器出现那行老掉牙的`Hello,world!`。不过咱就是人品太好了，卡在这边，报错了。

提示php环境出错，就是路径的问题。有个建议是可以用`dev_appserver.py --php_executable_path=`指定php路径，具体路径不知也。php咱是直接yum安装，也不知道肿么找路径，以前就是卡在这边烦了没再折腾。那时候还不知道有`which`这个指令，现在直接执行`which php-cgi`就可以啦，so easy，麻麻再也不用担心窝找不到安装包路径了。

<pre class="prettyprint linenums">
[fewspider@localhost ~]$ which php-cgi
/bin/php-cgi
</pre>

然后按下面把路径补上:

<pre class="prettyprint linenums">
./dev_appserver.py --php_executable_path=/bin/php-cgi ./helloworld 
</pre>

还是报错了╮(￣▽￣")╭

<pre class="prettyprint linenums">
_PHPEnvironmentError: The PHP runtime requires the "bccomp" function, which is not defined.
If you built PHP using "configure" then please rebuild with:
 ./configure  --enable-bcmath
</pre>

看最后的那些错误提示，原来还需要`bcmath`这个家伙，咱不是编译安装的，要不可以重新编译，在`./configure`后面加上`--enable-bcmath`，所以要另想办法先解决它。幸运的是fedora源里面有这个包，直接安装即可。

<pre class="prettyprint linenums">
yum install php-bcmath
</pre>

到这一步，页面访问就正常啦，可以看到`Hello,world!`了。之前折腾的时候，把php-cgi的路径填成php的路径，访问也正常，就是浏览器界面都是白色的==，注意是`php-cgi`才对。

上传应用也蛮简单的：
<pre class="prettyprint linenums">
appcfg.py update helloworld/
</pre>

然后就可以通过`http://your_app_id.appspot.com`访问到她了。

当然这里只是个演示，具体你得先申请一个app，app.yaml文件中的`application` 后面改为你自己的app id，要上传的那个文件夹改为app的名字。上传的时候会提示你输入邮箱地址和密码，没出错的话，就上传成功啦。

就介绍到这边啦，有兴趣的童鞋再具体查阅官方的指南，说得很详细，ヾ(￣▽￣)Bye~Bye~